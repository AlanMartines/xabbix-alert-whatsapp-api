zabbix_export:
  version: '7.0'
  media_types:
    - name: 'WhatsApp (Evolution API) - Graphic'
      type: SCRIPT
      script_name: whatsapp-graph-evolution-api.py
      parameters:
        - sortorder: '0'
          value: '<url_zabbix>'
        - sortorder: '1'
          value: '<zbx_login>'
        - sortorder: '2'
          value: '<zbx_pwd>'
        - sortorder: '3'
          value: '{ITEM.ID}'
        - sortorder: '4'
          value: '<url_api>'
        - sortorder: '5'
          value: '<api_key>'
        - sortorder: '6'
          value: '<instance>'
        - sortorder: '7'
          value: '{ALERT.SENDTO}'
        - sortorder: '8'
          value: '{ALERT.SUBJECT}'
        - sortorder: '9'
          value: '{ALERT.MESSAGE}'
      status: DISABLED
      attempts: '1'
      description: |
        Template de Alertas do Zabbix
        
        Alertas de Problemas (Triggers)
           Fonte do Evento: TRIGGERS
           Modo de Opera√ß√£o: PROBLEM
           Assunto: "Problem: {EVENT.NAME}"
           Mensagem:
             In√≠cio do problema √†s `{EVENT.TIME}` em `{EVENT.DATE}`
             Nome do problema: `{EVENT.NAME}`
             Host: `{HOST.NAME}`
             Severidade: `{EVENT.SEVERITY}`
             Dados operacionais: `{EVENT.OPDATA}`
             ID original do problema: `{EVENT.ID}`
             URL do Trigger: `{TRIGGER.URL}`
        
        Alertas de Recupera√ß√£o (Triggers)
           Fonte do Evento: TRIGGERS
           Modo de Opera√ß√£o: RECOVERY
           Assunto: "Resolved in {EVENT.DURATION}: {EVENT.NAME}"
           Mensagem:
             Problema resolvido em `{EVENT.DURATION}` √†s `{EVENT.RECOVERY.TIME}` em `{EVENT.RECOVERY.DATE}`
             Nome do problema: `{EVENT.NAME}`
             Host: `{HOST.NAME}`
             Severidade: `{EVENT.SEVERITY}`
             ID original do problema: `{EVENT.ID}`
             URL do Trigger: `{TRIGGER.URL}`
        
        Atualiza√ß√µes de Problemas (Triggers)
           Fonte do Evento: TRIGGERS
           Modo de Opera√ß√£o: UPDATE
           Assunto: "Updated problem: {EVENT.NAME}"
           Mensagem:
             `{USER.FULLNAME}` `{EVENT.UPDATE.ACTION}` o problema em `{EVENT.UPDATE.DATE}` `{EVENT.UPDATE.TIME}`.
             Mensagem de atualiza√ß√£o: `{EVENT.UPDATE.MESSAGE}`
             Status atual do problema: `{EVENT.STATUS}`, reconhecimento: `{EVENT.ACK.STATUS}`.
        
        Descoberta de Dispositivos (Discovery)
           Fonte do Evento: DISCOVERY
           Modo de Opera√ß√£o: PROBLEM
           Assunto: "Discovery: {DISCOVERY.DEVICE.STATUS} {DISCOVERY.DEVICE.IPADDRESS}"
           Mensagem:
             Regra de descoberta: `{DISCOVERY.RULE.NAME}`
             IP do dispositivo: `{DISCOVERY.DEVICE.IPADDRESS}`
             DNS do dispositivo: `{DISCOVERY.DEVICE.DNS}`
             Status do dispositivo: `{DISCOVERY.DEVICE.STATUS}`
             Tempo de atividade do dispositivo: `{DISCOVERY.DEVICE.UPTIME}`
             Nome do servi√ßo do dispositivo: `{DISCOVERY.SERVICE.NAME}`
             Porta do servi√ßo do dispositivo: `{DISCOVERY.SERVICE.PORT}`
             Status do servi√ßo do dispositivo: `{DISCOVERY.SERVICE.STATUS}`
             Tempo de atividade do servi√ßo do dispositivo: `{DISCOVERY.SERVICE.UPTIME}`
        
        Auto-registro de Hosts (Auto Registration)
           Fonte do Evento: AUTOREGISTRATION
           Modo de Opera√ß√£o: PROBLEM
           Assunto: "Autoregistration: {HOST.HOST}"
           Mensagem:
             Nome do host: `{HOST.HOST}`
             IP do host: `{HOST.IP}`
             Porta do agente: `{HOST.PORT}`
      message_templates:
        - event_source: TRIGGERS
          operation_mode: PROBLEM
          subject: '‚ùå *Problem:* {EVENT.NAME}'
          message: |
            üïí *Problem started:* {EVENT.TIME} on {EVENT.DATE}
            üö© *Problem name:* {EVENT.NAME}
            üíª *Host:* {HOST.NAME}
            üö® *Severity:* {EVENT.SEVERITY}
            üîç *Operational data:* {EVENT.OPDATA}
            üÜî *Original problem ID:* {EVENT.ID}
            üîó {TRIGGER.URL}
        - event_source: TRIGGERS
          operation_mode: RECOVERY
          subject: '‚úÖ *Resolved:* {EVENT.DURATION}: {EVENT.NAME}'
          message: |
            ‚è±Ô∏è *Problem resolved:* {EVENT.DURATION} at {EVENT.RECOVERY.TIME} on {EVENT.RECOVERY.DATE}
            üö© *Problem name:* {EVENT.NAME}
            üíª *Host:* {HOST.NAME}
            üö® *Severity:* {EVENT.SEVERITY}
            üÜî *Original problem ID:* {EVENT.ID}
            üîó {TRIGGER.URL}
        - event_source: TRIGGERS
          operation_mode: UPDATE
          subject: 'üîÑ *Updated problem:* {EVENT.NAME}'
          message: |
            üë§ {USER.FULLNAME} {EVENT.UPDATE.ACTION} problem at {EVENT.UPDATE.DATE} {EVENT.UPDATE.TIME}.
            üìù {EVENT.UPDATE.MESSAGE}
            
            *Current problem status:* {EVENT.STATUS}, acknowledged: {EVENT.ACK.STATUS}.
        - event_source: DISCOVERY
          operation_mode: PROBLEM
          subject: 'üîç Discovery: {DISCOVERY.DEVICE.STATUS} {DISCOVERY.DEVICE.IPADDRESS}'
          message: |
            üì° *Discovery rule:* {DISCOVERY.RULE.NAME}
            
            üåê *Device IP:* {DISCOVERY.DEVICE.IPADDRESS}
            üåê *Device DNS:* {DISCOVERY.DEVICE.DNS}
            üì∂ *Device status:* {DISCOVERY.DEVICE.STATUS}
            ‚è≥ *Device uptime:* {DISCOVERY.DEVICE.UPTIME}
            
            üõ†Ô∏è *Device service name:* {DISCOVERY.SERVICE.NAME}
            üö™ *Device service port:* {DISCOVERY.SERVICE.PORT}
            üì∂ *Device service status:* {DISCOVERY.SERVICE.STATUS}
            ‚è≥ *Device service uptime:* {DISCOVERY.SERVICE.UPTIME}
        - event_source: AUTOREGISTRATION
          operation_mode: PROBLEM
          subject: 'üì• Autoregistration: {HOST.HOST}'
          message: |
            üíª *Host name:* {HOST.HOST}
            üåê *Host IP:* {HOST.IP}
            üö™ *Agent port:* {HOST.PORT}
